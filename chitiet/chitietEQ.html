<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chi ti·∫øt s·∫£n ph·∫©m</title>
   <link rel="stylesheet" href="../css/footer.css">
<link rel="stylesheet" href="../css/chitietsanpham.css">
</head>
<body>

<a href="../index.html" class="back-home">‚Üê Quay v·ªÅ trang ch·ªß</a>

<div class="product-detail">

  <!-- ·∫¢NH S·∫¢N PH·∫®M -->
  <div class="product-images">
    <img src="../IMAGES/kalimba/EQ_Black/EQ_avt.jpg" alt="Kalimba_EQ_BLACK" class="main-img">
  </div>

  <!-- TH√îNG TIN S·∫¢N PH·∫®M -->
  <div class="product-info">
    <h1 class="product-title">
      Kalimba EQ Black
    </h1>

    <div class="price-box">
      <span class="old-price">5.000.000ƒë</span>
      <span class="new-price">2.500.000ƒë</span>
      <span class="discount">-50%</span>
    </div>

    <p class="description">
      Kalimba t√≠ch h·ª£p EQ gi√∫p k·∫øt n·ªëi v·ªõi loa ngo√†i, ph√π h·ª£p bi·ªÉu di·ªÖn s√¢n kh·∫•u ho·∫∑c thu √¢m.
    </p>

    <!-- VOUCHER -->
    <div class="voucher-box">
      <div class="voucher">Gi·∫£m 20K</div>
      <div class="voucher">Gi·∫£m 25K</div>
      <div class="voucher">Gi·∫£m 30K</div>
    </div>

    <!-- S·ªê L∆Ø·ª¢NG -->
    <div class="quantity">
      <span>S·ªë l∆∞·ª£ng:</span>
      <button onclick="giam()">‚àí</button>
      <input type="text" id="qty" value="1">
      <button onclick="tang()">+</button>
    </div>

     <!-- N√öT -->
    <div class="action-buttons">

      <!-- TH√äM GI·ªé -->
      <button
        onclick="addToCart(this)"
        data-id="sp11"
        data-name="Kalimba EQ Black"
        data-price="2500000"
        data-image="../IMAGES/kalimba/EQ_Black/EQ_avt.jpg">
        Th√™m v√†o gi·ªè
      </button>

      <!-- MUA NGAY -->
      <button
        class="buy-now"
        onclick="buyNow(this)"
        data-id="sp11"
        data-name="Kalimba EQ Black"
        data-price="2500000"
        data-image="../IMAGES/kalimba/EQ_Black/EQ_avt.jpg">
        Mua ngay
      </button>

    </div>

  </div>
</div>
<div class="review-section">
  <h3>ƒê√°nh gi√° s·∫£n ph·∫©m</h3>

  <!-- ƒêi·ªÉm trung b√¨nh -->
  <div class="review-summary">
    <span id="avgRating">5.0</span> ‚òÖ
    <span id="totalReviews">(0 ƒë√°nh gi√°)</span>
  </div>

  <!-- Danh s√°ch ƒë√°nh gi√° -->
  <div id="reviewList"></div>

  <!-- Form ng∆∞·ªùi d√πng ƒë√°nh gi√° -->
  <div class="review-form">
    <h4>Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n</h4>
    <input type="text" id="reviewName" placeholder="T√™n c·ªßa b·∫°n">
    
    <select id="reviewRating">
      <option value="5">5 ‚òÖ</option>
      <option value="4">4 ‚òÖ</option>
      <option value="3">3 ‚òÖ</option>
      <option value="2">2 ‚òÖ</option>
      <option value="1">1 ‚òÖ</option>
    </select>

    <textarea id="reviewComment" placeholder="C·∫£m nh·∫≠n c·ªßa b·∫°n v·ªÅ s·∫£n ph·∫©m"></textarea>
    <button onclick="addReview()">G·ª≠i ƒë√°nh gi√°</button>
  </div>
</div>

<div id="footer"></div>
<script>
fetch("../footer.html")
  .then(res => res.text())
  .then(html => {
    document.getElementById("footer").innerHTML = html;
  });
</script>
<script>
function addToCart(btn){
  const qty = Number(document.getElementById("qty").value);

  const product = {
    id: btn.dataset.id,
    name: btn.dataset.name,
    price: Number(btn.dataset.price),
    oldPrice: Number(btn.dataset.oldprice),
    image: btn.dataset.image,
    quantity: qty
  };

  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  const exist = cart.find(p => p.id === product.id);
  if(exist){
    exist.quantity += qty;
  }else{
    cart.push(product);
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  window.location.href = "../cart.html";
}

function buyNow(btn){
  const qty = Number(document.getElementById("qty").value);

  const product = {
    id: btn.dataset.id,
    name: btn.dataset.name,
    price: Number(btn.dataset.price),
    oldPrice: Number(btn.dataset.oldprice),
    image: btn.dataset.image,
    quantity: qty
  };

  localStorage.setItem("buyNow", JSON.stringify(product));
  window.location.href = "../thanhtoan.html";
}
function tang(){
  const qtyInput = document.getElementById("qty");
  qtyInput.value = parseInt(qtyInput.value || 1) + 1;
}

function giam(){
  const qtyInput = document.getElementById("qty");
  let val = parseInt(qtyInput.value || 1);
  if(val > 1) qtyInput.value = val - 1;
}
</script>

<script>
const reviewKey = "eq_reviews"; // m·ªói trang s·∫£n ph·∫©m c√≥ th·ªÉ ƒë·ªïi key kh√°c nhau

// ƒê√°nh gi√° gi·∫£ ban ƒë·∫ßu
const defaultReviews = [
  { user: "Minh Anh", rating: 5, comment: "ƒê√†n ƒë·∫πp h∆°n h√¨nh, √¢m thanh r·∫•t ·∫•m", date: "2 ng√†y tr∆∞·ªõc" },
  { user: "Ho√†ng Ph√∫c", rating: 4, comment: "Giao nhanh, m·ªõi t·∫≠p ch∆°i th·∫•y ·ªïn", date: "5 ng√†y tr∆∞·ªõc" },
  { user: "Lan Chi", rating: 5, comment: "Mua t·∫∑ng ng∆∞·ªùi y√™u, ·∫£nh th√≠ch l·∫Øm ü•∞", date: "1 tu·∫ßn tr∆∞·ªõc" }
];

// L·∫•y d·ªØ li·ªáu t·ª´ localStorage ho·∫∑c d√πng fake ban ƒë·∫ßu
let reviews = JSON.parse(localStorage.getItem(reviewKey)) || defaultReviews;

const reviewList = document.getElementById("reviewList");

function saveReviews() {
  localStorage.setItem(reviewKey, JSON.stringify(reviews));
}

function renderReviews(){
  reviewList.innerHTML = "";
  let total = 0;

  reviews.forEach(r => {
    total += r.rating;
    let stars = "‚òÖ".repeat(r.rating) + "‚òÜ".repeat(5 - r.rating);

    reviewList.innerHTML += `
      <div class="review-item">
        <div class="review-user">${r.user} <span style="color:#888;font-size:12px">‚Ä¢ ${r.date}</span></div>
        <div class="review-stars">${stars}</div>
        <div class="review-text">${r.comment}</div>
      </div>
    `;
  });

  let avg = (total / reviews.length).toFixed(1);
  document.getElementById("avgRating").innerText = avg;
  document.getElementById("totalReviews").innerText = `(${reviews.length} ƒë√°nh gi√°)`;
}

function addReview(){
  let name = document.getElementById("reviewName").value.trim();
  let rating = parseInt(document.getElementById("reviewRating").value);
  let comment = document.getElementById("reviewComment").value.trim();

  if(name === "" || comment === ""){
    alert("Vui l√≤ng nh·∫≠p t√™n v√† n·ªôi dung ƒë√°nh gi√°");
    return;
  }

  let newReview = {
    user: name,
    rating: rating,
    comment: comment,
    date: "V·ª´a xong"
  };

  reviews.unshift(newReview); // th√™m l√™n ƒë·∫ßu
  saveReviews();              // üî• l∆∞u l·∫°i
  renderReviews();

  document.getElementById("reviewName").value = "";
  document.getElementById("reviewComment").value = "";
}

// G·ªçi khi load trang
renderReviews();
</script>

</body>
</html>